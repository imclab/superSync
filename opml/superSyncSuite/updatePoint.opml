<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- OPML generated by OPML Editor v10.1a16 on Sat, 14 Dec 2013 15:09:10 GMT -->
<opml version="2.0">
	<head>
		<title>superSyncSuite.updatePoint</title>
		<dateCreated>Mon, 25 Nov 2013 01:15:42 GMT</dateCreated>
		<dateModified>Sat, 14 Dec 2013 15:09:10 GMT</dateModified>
		<ownerName>Dave Winer</ownerName>
		<ownerId>http://davewiner.com/</ownerId>
		<expansionState>1, 2, 3, 9</expansionState>
		<vertScrollState>1</vertScrollState>
		<windowTop>218</windowTop>
		<windowLeft>614</windowLeft>
		<windowBottom>1142</windowBottom>
		<windowRight>1969</windowRight>
		</head>
	<body>
		<outline text="on updatePoint (adrpoint)">
			<outline text="Changes" isComment="true">
				<outline text="12/14/13; 9:38:12 AM by DW">
					<outline text="Fixed a bug where we'd go to the summit of the outline even if we logged nothing. Would make the OPML Editor basically unusuable. Sorry about that! ;-("/>
					</outline>
				<outline text="11/24/13; 8:15:49 PM by DW">
					<outline text="Created."/>
					</outline>
				</outline>
			<outline text="local (adrdata = superSyncSuite.init ())"/>
			<outline text="superSyncSuite.initPoint (nameof (adrpoint^))"/>
			<outline text="if adrpoint^.prefs.enabled">
				<outline text="local (floutlinesetup = false)"/>
				<outline text="on setupoutline ()">
					<outline text="if not floutlinesetup">
						<outline text="if not defined (adroutline^)">
							<outline text="new (outlinetype, adroutline)"/>
							<outline text="target.set (adroutline)"/>
							<outline text="window.setsize (adroutline, 500, 300)"/>
							<outline text="op.setlinetext (clock.now ())"/>
							<outline text="edit (adroutline)"/>
							</outline>
						<outline text="else">
							<outline text="if not window.isopen (adroutline)">
								<outline text="edit (adroutline)"/>
								</outline>
							<outline text="target.set (adroutline)"/>
							<outline text="op.fullcollapse ()"/>
							<outline text="op.firstsummit ()"/>
							<outline text="op.insert (clock.now (), up)"/>
							</outline>
						<outline text="floutlinesetup = true"/>
						</outline>
					</outline>
				<outline text="local (folder = adrpoint^.prefs.folder, s3folderpath = adrpoint^.prefs.s3path)"/>
				<outline text="local (adroutline = @adrpoint^.stats.log, dir = right)"/>
				<outline text="fileloop (f in folder, infinity)">
					<outline text="if f endswith &quot;.html&quot;">
						<outline text="local (filepath = string.delete (f, 1, sizeof (folder)), filetext)"/>
						<outline text="local (adrfile = @adrpoint^.stats.files.[filepath])"/>
						<outline text="if not defined (adrfile^)">
							<outline text="new (tabletype, adrfile)"/>
							<outline text="adrfile^.ctlooks = 0"/>
							<outline text="adrfile^.ctwrites = 0"/>
							<outline text="adrfile^.whenLastWrite = date (0)"/>
							<outline text="adrfile^.ctConsecutiveErrors = 0"/>
							<outline text="adrfile^.ctErrors = 0"/>
							</outline>
						<outline text="if file.modified (f) &gt; adrfile^.whenLastWrite">
							<outline text="filepath = s3folderpath + string.replaceall (filepath, file.getpathchar (), &quot;/&quot;)"/>
							<outline text="filetext = string (file.readwholefile (f))"/>
							<outline text="if sizeof (filetext) == 0">
								<outline text="filetext = &quot; &quot;"/>
								</outline>
							<outline text="try">
								<outline text="s3.newobject (filepath, filetext)"/>
								<outline text="if adrdata^.prefs.flLogEnabled">
									<outline text="setupoutline ()"/>
									<outline text="op.insert (filepath, dir); dir = down"/>
									</outline>
								<outline text="new (tabletype, @atts)"/>
								<outline text="atts.type = &quot;link&quot;"/>
								<outline text="atts.url = &quot;http:/&quot; + filepath"/>
								<outline text="op.attributes.addgroup (@atts)"/>
								<outline text="adrpoint^.stats.ctUploads++"/>
								<outline text="adrpoint^.stats.whenLastUpload = clock.now ()"/>
								<outline text="adrfile^.ctwrites++"/>
								<outline text="adrfile^.whenLastWrite = clock.now ()"/>
								<outline text="adrfile^.ctConsecutiveErrors = 0"/>
								</outline>
							<outline text="else">
								<outline text="adrfile^.ctErrors++"/>
								<outline text="adrfile^.ctConsecutiveErrors++"/>
								<outline text="adrfile^.whenLastError = clock.now ()"/>
								<outline text="adrfile^.lasterror = tryerror"/>
								<outline text="adrpoint^.stats.lastError = tryerror"/>
								</outline>
							</outline>
						<outline text="adrfile^.ctlooks++"/>
						</outline>
					</outline>
				<outline text="if floutlinesetup">
					<outline text="op.firstsummit ()"/>
					</outline>
				</outline>
			</outline>
		<outline text="bundle //test code">
			<outline text="updatePoint (@config.superSync.points.fargoDocs)"/>
			</outline>
		</body>
	</opml>
